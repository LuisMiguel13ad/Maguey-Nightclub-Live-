---
phase: 05-dashboard-accuracy
plan: 05
type: execute
wave: 3
depends_on: ["05-03", "05-04"]
files_modified:
  - maguey-gate-scanner/src/pages/Dashboard.tsx
autonomous: false

must_haves:
  truths:
    - "Revenue figures in dashboard match Stripe transaction totals"
    - "Ticket count displays match database query results"
    - "Analytics charts update in real-time as transactions occur"
  artifacts:
    - path: "maguey-gate-scanner/src/pages/Dashboard.tsx"
      provides: "Complete dashboard with all accuracy features"
      contains: "LiveIndicator|RevenueVerification|CheckInProgress"
  key_links:
    - from: "Dashboard.tsx"
      to: "verify-revenue"
      via: "revenue-verification-service"
      pattern: "verifyRevenue|RevenueVerification"
---

<objective>
Final validation and polish of dashboard accuracy features.

Purpose: Verify all success criteria are met - revenue matches Stripe, ticket counts accurate, real-time updates working, exports functional.

Output: Validated dashboard with all accuracy requirements passing.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-dashboard-accuracy/05-CONTEXT.md
@.planning/phases/05-dashboard-accuracy/05-01-SUMMARY.md
@.planning/phases/05-dashboard-accuracy/05-02-SUMMARY.md
@.planning/phases/05-dashboard-accuracy/05-03-SUMMARY.md
@.planning/phases/05-dashboard-accuracy/05-04-SUMMARY.md
@maguey-gate-scanner/src/pages/Dashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate CheckInProgress into Dashboard</name>
  <files>maguey-gate-scanner/src/pages/Dashboard.tsx</files>
  <action>
Add CheckInProgress component to Dashboard:

1. Import component:
   - import { CheckInProgress } from '@/components/dashboard/CheckInProgress'

2. Position in dashboard:
   - Add near the existing Check-In Rates chart section
   - Or replace the horizontal bar chart with CheckInProgress for simpler display
   - Per CONTEXT.md: "Simple display ('125 / 200 checked in' with progress bar)"

3. Wire to active event:
   - Use activeEvent state (already exists in Dashboard)
   - Pass eventId and eventName to CheckInProgress

4. Ensure real-time updates flow through:
   - CheckInProgress should update when useDashboardRealtime triggers
   - Or have its own subscription (component handles internally)

5. Polish existing charts:
   - Verify Sales over time chart works (dailyWeeklySales)
   - Verify Revenue breakdown by tier (tierStats)
   - Both should update via real-time subscription
  </action>
  <verify>
Dashboard shows CheckInProgress with accurate counts. Check-in events trigger progress updates.
  </verify>
  <done>
Dashboard includes CheckInProgress component displaying live check-in counts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate export functionality</name>
  <files>maguey-gate-scanner/src/pages/Dashboard.tsx</files>
  <action>
Verify export capabilities work correctly per CONTEXT.md:

1. Test CSV export:
   - Click "Quick CSV" button
   - Verify file downloads with correct data
   - Check columns include: Time, Ticket ID, Result, Tier, Override, Scanned By

2. Test PDF export:
   - Open Advanced Export dialog
   - Select "Scan Logs" + "PDF"
   - Verify PDF generates with proper formatting

3. Test Excel export:
   - Export revenue report
   - Export staff performance report
   - Verify Excel files open correctly

4. Fix any issues found:
   - Update report-service.ts if needed
   - Ensure date filtering works
   - Verify event/tier filters apply

5. Add export for revenue verification history (optional enhancement):
   - Export discrepancies to CSV
   - Include: Date, DB Revenue, Stripe Revenue, Discrepancy, Status
  </action>
  <verify>
All export buttons produce valid files. CSV, PDF, and Excel formats work correctly.
  </verify>
  <done>
Export functionality validated - CSV, PDF, Excel all produce correct output.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Dashboard Accuracy implementation:
- Revenue reconciliation with Stripe (shows both figures when mismatch)
- Live indicator showing real-time connection status
- Check-in progress bars with "X / Y checked in" display
- Event sync to purchase site within 30 seconds
- Export capabilities (CSV, PDF, Excel)
  </what-built>
  <how-to-verify>
1. **Revenue Accuracy Test:**
   - Open Dashboard at http://localhost:5173/dashboard (gate-scanner)
   - Verify revenue total is displayed
   - If discrepancy exists, verify BOTH DB and Stripe figures shown
   - Look for "Revenue verified" indicator or discrepancy warning

2. **Real-time Test:**
   - Verify "Live" indicator shows with pulsing green dot
   - Open second browser tab
   - Make a test purchase or scan a ticket
   - Dashboard should update within a few seconds

3. **Check-in Progress Test:**
   - Find CheckInProgress component showing "X / Y checked in"
   - Verify progress bar reflects percentage
   - If possible, scan a ticket and watch counter increment

4. **Event Sync Test:**
   - Open Checkout page in pass-lounge: http://localhost:3016/checkout
   - In Supabase dashboard (or API), create a new test event
   - Within 30 seconds, refresh Checkout page
   - New event should appear in event list

5. **Export Test:**
   - Click "Quick CSV" - file should download
   - Click "Advanced Export" - try PDF and Excel options
   - Verify files contain expected data
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. All success criteria from ROADMAP.md Phase 5 verified:
   - Revenue figures match Stripe transaction totals
   - Ticket count displays match database query results
   - Events created in dashboard appear on purchase site within 30 seconds
   - VIP reservations show in dashboard immediately
   - Analytics charts update in real-time

2. User decisions from CONTEXT.md honored:
   - Show gross revenue (what customers paid)
   - Transparency: show both data sources when mismatch
   - Always-visible live indicator
   - Both CSV and PDF export
</verification>

<success_criteria>
- Human verification confirms all dashboard accuracy features working
- No visible discrepancies between displayed and actual data
- Real-time updates verified manually
- Export functionality produces valid files
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-accuracy/05-05-SUMMARY.md`
</output>
