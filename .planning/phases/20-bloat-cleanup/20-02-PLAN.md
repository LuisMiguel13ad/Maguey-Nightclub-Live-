---
phase: 20-bloat-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx
  - maguey-gate-scanner/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Production sidebar shows exactly: Dashboard, Events, Ticket Sales, VIP Tables, Analytics, Staff, Audit Log, Notifications, System Health"
    - "System Health item links to a valid route showing a health indicator"
    - "Sidebar sections match recommended structure: MAIN, SALES, TEAM, SETTINGS"
    - "No existing routes broken — all linked sidebar paths still work"
  artifacts:
    - path: "maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx"
      provides: "Simplified sidebar with 4 sections and System Health item"
      contains: "System Health"
  key_links:
    - from: "maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx"
      to: "App.tsx routes"
      via: "sidebar path values matching route definitions"
      pattern: "path:.*/(dashboard|events|orders|vip-tables|analytics|team|audit-log|notifications)"
---

<objective>
Implement the simplified sidebar structure matching the recommended layout from the planning context.

Purpose: The current production sidebar (after 20-01 hides MONITORING) has the correct MAIN, SALES, TEAM, and SETTINGS sections but is missing "System Health." This plan adds a System Health item to SETTINGS that links to the Errors monitoring page — but only in a simplified "indicator" form. It also verifies the sidebar exactly matches the recommended structure.

Output: Sidebar matches recommended simplified structure with System Health indicator.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx
@maguey-gate-scanner/src/App.tsx
@.planning/phases/20-bloat-cleanup/20-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add System Health item to SETTINGS section and verify sidebar structure</name>
  <files>maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx</files>
  <action>
In `maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx`, update the `sidebarSections` array to add a "System Health" item to the SETTINGS section.

Step 1: Add the `HeartPulse` icon import from lucide-react (add to existing import block):
```tsx
import { ..., HeartPulse } from "lucide-react";
```

If `HeartPulse` is not available in the project's lucide-react version, use `Activity` instead (already imported).

Step 2: Add "System Health" to the SETTINGS section items array, after the existing Notifications item:

```tsx
{
  title: "SETTINGS",
  ownerOnly: true,
  items: [
    { title: "Notifications", path: "/notifications/preferences", icon: Bell, ownerOnly: true },
    { title: "System Health", path: "/monitoring/errors", icon: HeartPulse, ownerOnly: true },
  ],
},
```

Note: System Health links to `/monitoring/errors` which is the most useful monitoring page for a nightclub owner (error visibility). This route is currently gated behind `requireDev` from Plan 20-01. We need to make an exception — System Health should be accessible in production.

Step 3: In `maguey-gate-scanner/src/App.tsx`, remove `requireDev` from ONLY the `/monitoring/errors` route so it remains accessible in production as the "System Health" page. The other 5 monitoring routes keep `requireDev`.

Change:
```tsx
<Route path="/monitoring/errors" element={<ProtectedRoute requireDev allowedRoles={['owner', 'promoter']}><ErrorsPage /></ProtectedRoute>} />
```
To:
```tsx
<Route path="/monitoring/errors" element={<ProtectedRoute allowedRoles={['owner', 'promoter']}><ErrorsPage /></ProtectedRoute>} />
```

Step 4: Verify the final sidebar sections array matches this exact structure (excluding devOnly MONITORING section):

```
MAIN:       Dashboard (/dashboard), Events (/events)
SALES:      Ticket Sales (/orders), VIP Tables (/vip-tables), Analytics (/analytics)
TEAM:       Staff (/team), Audit Log (/audit-log)  [ownerOnly]
SETTINGS:   Notifications (/notifications/preferences), System Health (/monitoring/errors)  [ownerOnly]
```

This matches the recommended simplified sidebar from the planning context exactly.
  </action>
  <verify>
Run `grep "System Health" maguey-gate-scanner/src/components/layout/OwnerPortalLayout.tsx` to confirm the item exists. Run `grep -c "requireDev" maguey-gate-scanner/src/App.tsx` — should return 6 (1 test-qr + 5 monitoring routes, errors route no longer has it). Count sidebar items (excluding devOnly section): should be exactly 9 items across 4 sections.
  </verify>
  <done>Sidebar matches recommended simplified structure: MAIN (2 items), SALES (3 items), TEAM (2 items), SETTINGS (2 items including System Health). System Health links to error monitoring page accessible in production. MONITORING section remains dev-only.</done>
</task>

</tasks>

<verification>
1. Sidebar in production shows exactly 4 sections: MAIN, SALES, TEAM, SETTINGS
2. System Health item exists in SETTINGS section
3. `/monitoring/errors` route works in production (no requireDev)
4. Other 5 `/monitoring/*` routes still gated behind requireDev
5. All existing sidebar items still link to valid routes
6. TypeScript compiles without errors
</verification>

<success_criteria>
- Production sidebar matches recommended structure exactly (9 items across 4 sections)
- System Health item links to `/monitoring/errors` (accessible in production)
- 5 remaining monitoring routes still dev-only
- No files deleted
</success_criteria>

<output>
After completion, create `.planning/phases/20-bloat-cleanup/20-02-SUMMARY.md`
</output>
