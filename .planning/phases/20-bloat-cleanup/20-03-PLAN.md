---
phase: 20-bloat-cleanup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx
  - maguey-gate-scanner/src/pages/FraudInvestigation.tsx
  - maguey-gate-scanner/src/pages/NotificationRules.tsx
autonomous: true

must_haves:
  truths:
    - "Analytics page has 3 tabs labeled Revenue, Attendance, and Staff"
    - "Fraud Investigation page uses OwnerPortalLayout instead of Navigation component"
    - "Notification Rules page has a simplified view with on/off toggles for each rule"
    - "All data fetching and display logic preserved — no functional regressions"
  artifacts:
    - path: "maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx"
      provides: "Analytics page with 3 renamed tabs"
      contains: "Revenue"
    - path: "maguey-gate-scanner/src/pages/FraudInvestigation.tsx"
      provides: "Fraud page wrapped in OwnerPortalLayout"
      contains: "OwnerPortalLayout"
    - path: "maguey-gate-scanner/src/pages/NotificationRules.tsx"
      provides: "Notification Rules with simplified toggle-based UI"
      contains: "Switch"
  key_links:
    - from: "maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx"
      to: "Tabs component"
      via: "TabsTrigger value props"
      pattern: "value=\"(revenue|attendance|staff)\""
    - from: "maguey-gate-scanner/src/pages/FraudInvestigation.tsx"
      to: "OwnerPortalLayout"
      via: "layout wrapper import"
      pattern: "import.*OwnerPortalLayout"
---

<objective>
Simplify three complex owner-facing pages: rename Analytics tabs, clean up Fraud page layout, and simplify Notification Rules to on/off toggles.

Purpose: These pages are overly complex for a nightclub owner. Analytics has generic tab names, Fraud uses an old Navigation component instead of the owner layout, and Notification Rules has a full CRUD interface when simple toggles suffice for v1.

Output: Cleaner, more focused pages that match owner expectations.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx
@maguey-gate-scanner/src/pages/FraudInvestigation.tsx
@maguey-gate-scanner/src/pages/NotificationRules.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename Analytics tabs from Overview/Sales/Operations to Revenue/Attendance/Staff</name>
  <files>maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx</files>
  <action>
In `maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx`, rename the 3 existing tabs. The content within each tab stays exactly the same — only the tab trigger labels and values change.

Step 1: Update the `<Tabs defaultValue="overview">` to `<Tabs defaultValue="revenue">`.

Step 2: Update the 3 `<TabsTrigger>` elements:
- `value="overview"` → `value="revenue"`, label text "Overview" → "Revenue"
- `value="sales"` → `value="attendance"`, label text "Sales" → "Attendance"
- `value="operations"` → `value="staff"`, label text "Operations" → "Staff"

Step 3: Update the 3 `<TabsContent>` elements to match:
- `value="overview"` → `value="revenue"`
- `value="sales"` → `value="attendance"`
- `value="operations"` → `value="staff"`

Step 4: Update the page title if it says "Advanced Analytics" — change to just "Analytics" in the OwnerPortalLayout title prop.

Do NOT modify any chart components, data fetching, or display logic inside the tab content. Only labels, tab values, and the page title change.
  </action>
  <verify>
Run `grep -c 'value="revenue"\|value="attendance"\|value="staff"' maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx` — should return 6 (3 triggers + 3 contents). Run `grep "overview\|sales\|operations" maguey-gate-scanner/src/pages/AdvancedAnalytics.tsx` to confirm old values are gone (should only match in comments or data field names, not in tab values).
  </verify>
  <done>Analytics page shows 3 tabs: Revenue, Attendance, Staff. Tab content unchanged. Page title simplified to "Analytics".</done>
</task>

<task type="auto">
  <name>Task 2: Update Fraud page layout and simplify Notification Rules to toggles</name>
  <files>maguey-gate-scanner/src/pages/FraudInvestigation.tsx, maguey-gate-scanner/src/pages/NotificationRules.tsx</files>
  <action>
**Part A: Fraud Investigation layout fix**

In `maguey-gate-scanner/src/pages/FraudInvestigation.tsx`:

1. Replace the `Navigation` import with `OwnerPortalLayout`:
   - Remove: `import { Navigation } from '@/components/Navigation';`
   - Add: `import OwnerPortalLayout from '@/components/layout/OwnerPortalLayout';`

2. In the return JSX, replace the `<Navigation>` wrapper with `<OwnerPortalLayout>`:
   - Find the wrapping component (likely `<Navigation>` near the top of the return)
   - Replace with `<OwnerPortalLayout title="Security Alerts" subtitle="SECURITY" description="Review flagged scan attempts and fraud indicators">`
   - Close with `</OwnerPortalLayout>`

3. Change the page heading/title from "Fraud Investigation" to "Security Alerts" wherever it appears in the JSX (not the filename — keep the file as-is per no-deletion constraint). Update any description text to be more owner-friendly (e.g., "Review flagged scan attempts" instead of "Comprehensive fraud investigation dashboard").

**Part B: Notification Rules simplification**

In `maguey-gate-scanner/src/pages/NotificationRules.tsx`:

1. Replace the `Navigation` import with `OwnerPortalLayout`:
   - Remove: `import { Navigation } from '@/components/Navigation';`
   - Add: `import OwnerPortalLayout from '@/components/layout/OwnerPortalLayout';`

2. Wrap the page content in `<OwnerPortalLayout title="Notification Rules" subtitle="SETTINGS">` instead of `<Navigation>`.

3. Gate the complex CRUD features (Create Rule dialog/button, Edit button, Delete button, Test Rule button) behind `import.meta.env.DEV`:
   - Wrap the "Add Rule" / "Create Rule" button in `{import.meta.env.DEV && (...)}`
   - Wrap the edit/delete action buttons on each rule row in `{import.meta.env.DEV && (...)}`
   - Wrap the Test Rule button (if present) in `{import.meta.env.DEV && (...)}`

4. Ensure each notification rule in the list shows: rule name, description/trigger type, and a `<Switch>` toggle for enabling/disabling. The Switch toggle functionality (calling the update API to toggle `is_active`) should remain fully functional in production — only the CRUD (create/edit/delete) buttons are hidden.

The result: In production, the page shows a clean list of rules with on/off toggles. In dev mode, full CRUD is available.
  </action>
  <verify>
Run `grep "OwnerPortalLayout" maguey-gate-scanner/src/pages/FraudInvestigation.tsx` to confirm layout change. Run `grep "Security Alerts" maguey-gate-scanner/src/pages/FraudInvestigation.tsx` to confirm title change. Run `grep "OwnerPortalLayout" maguey-gate-scanner/src/pages/NotificationRules.tsx` to confirm layout change. Run `grep "import.meta.env.DEV" maguey-gate-scanner/src/pages/NotificationRules.tsx` to confirm dev-gating exists. Run `grep "Navigation" maguey-gate-scanner/src/pages/FraudInvestigation.tsx maguey-gate-scanner/src/pages/NotificationRules.tsx` — should return no matches.
  </verify>
  <done>Fraud page uses OwnerPortalLayout with "Security Alerts" title. Notification Rules uses OwnerPortalLayout with CRUD buttons hidden in production, simple on/off toggles visible in all environments.</done>
</task>

</tasks>

<verification>
1. Analytics page: 3 tabs named Revenue, Attendance, Staff — content unchanged
2. Fraud page: Uses OwnerPortalLayout, titled "Security Alerts"
3. Notification Rules: Uses OwnerPortalLayout, CRUD buttons dev-only, toggles work in production
4. No `Navigation` imports in FraudInvestigation.tsx or NotificationRules.tsx
5. All data fetching and display logic preserved
6. TypeScript compiles without errors
</verification>

<success_criteria>
- Analytics tabs renamed to Revenue/Attendance/Staff with no content changes
- Fraud page consistently uses OwnerPortalLayout and friendly "Security Alerts" branding
- Notification Rules shows simple toggle list in production, full CRUD in dev mode
- Zero regressions in data display or functionality
</success_criteria>

<output>
After completion, create `.planning/phases/20-bloat-cleanup/20-03-SUMMARY.md`
</output>
