---
phase: 18
plan: 18-01
title: "Auto-detect tonight's event + date display in dropdown"
wave: 1
depends_on: []
files_modified:
  - maguey-gate-scanner/src/pages/Scanner.tsx
autonomous: true
---

# Plan 18-01: Auto-detect tonight's event + date display

## Objective
Scanner auto-selects tonight's event on load. Event dropdown shows formatted dates and a "TONIGHT" badge for the current event.

## Requirements
- R19: No event date awareness (auto-detect tonight)
- R20: Event dropdown doesn't show dates

## Tasks

<task id="1">
Replace `getEventsFromTickets` import with `getActiveEvents` in Scanner.tsx. The existing `getActiveEvents()` function in simple-scanner.ts already queries the `events` table with date filtering and returns `{id, name, event_date}`.
</task>

<task id="2">
Update events state type from `{id, name}[]` to `{id, name, event_date}[]`.
</task>

<task id="3">
Add auto-detection logic in the loadEvents effect: after setting events, find today's event by comparing `event_date.split('T')[0]` to today's date. Auto-select via `setSelectedEvent` + `setSelectedEventId`.
</task>

<task id="4">
Update dropdown button label to show date when an event is selected: "Event Name â€” Feb 14" format.
</task>

<task id="5">
Update dropdown items to show formatted date and a green "TONIGHT" badge for today's event.
</task>

## Verification
- [ ] Scanner auto-selects tonight's event on load
- [ ] Event dropdown shows dates next to event names
- [ ] "TONIGHT" badge appears on today's event
- [ ] "All Events" still works as default when no event today

## must_haves
- Tonight's event auto-selected on scanner load
- Event dates visible in dropdown
