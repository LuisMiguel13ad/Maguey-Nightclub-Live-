---
phase: 18
plan: 18-04
title: "Rate limit manual entry + display device ID"
wave: 1
depends_on: []
files_modified:
  - maguey-gate-scanner/src/lib/rate-limiter.ts
  - maguey-gate-scanner/src/pages/Scanner.tsx
autonomous: true
---

# Plan 18-04: Rate limit manual entry + display device ID

## Objective
Rate-limit manual ticket entry to 5 attempts per minute per device. Display the device ID in the scanner header for staff identification.

## Requirements
- R24: No rate limiting on manual entry
- R25: No device ID shown to staff

## Tasks

<task id="1">
Add `manualEntryLimiter` to rate-limiter.ts: 5 requests/min per device, using existing `RateLimiter` class.
</task>

<task id="2">
Import `manualEntryLimiter` and `getDeviceInfo` in Scanner.tsx. Add device ID state via `useState(() => getDeviceInfo().deviceId)`.
</task>

<task id="3">
Update `handleManualSubmit` to check `manualEntryLimiter.increment(deviceId)` before calling `processScan`. Show destructive toast "Too many attempts" if rate limited.
</task>

<task id="4">
Add device ID pill in scanner header (after BatteryIndicator): shows last 6 chars of device ID in monospace, click-to-copy full ID with toast confirmation.
</task>

## Verification
- [ ] 6th manual entry within 1 minute shows "Too many attempts" toast
- [ ] After 60 seconds, manual entry works again
- [ ] Device ID visible in scanner header (last 6 chars)
- [ ] Clicking device ID copies full ID to clipboard
- [ ] QR/NFC scans not affected by manual rate limit

## must_haves
- Manual entry rate limited to 5/min
- Device ID visible in scanner header
