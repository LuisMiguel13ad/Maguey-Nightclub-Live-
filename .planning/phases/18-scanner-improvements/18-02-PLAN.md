---
phase: 18
plan: 18-02
title: "Offline mode: reject unknown tickets"
wave: 1
depends_on: []
files_modified:
  - maguey-gate-scanner/src/lib/simple-scanner.ts
  - maguey-gate-scanner/src/components/scanner/RejectionOverlay.tsx
autonomous: true
---

# Plan 18-02: Offline mode reject unknown tickets

## Objective
When offline, reject tickets not in the IndexedDB cache instead of accepting with a warning.

## Requirements
- R21: Offline mode accepts unknown tickets

## Tasks

<task id="1">
Change `not_in_cache` handler in `scanTicketOffline` (simple-scanner.ts) from `success: true` with offlineWarning to `success: false` with `rejectionReason: 'offline_unknown'`.
</task>

<task id="2">
Add `'offline_unknown'` to the `RejectionReason` type in RejectionOverlay.tsx.
</task>

<task id="3">
Add `case 'offline_unknown'` to the `getErrorContent` switch in RejectionOverlay.tsx with title "NOT IN CACHE" and subtitle prompting to connect to internet.
</task>

## Verification
- [ ] Offline scan of unknown ticket shows red "NOT IN CACHE" overlay
- [ ] Offline scan of cached valid ticket still shows green SUCCESS
- [ ] Offline scan of already-scanned ticket still shows "ALREADY SCANNED"

## must_haves
- Unknown tickets rejected in offline mode
- Clear UI feedback explaining the rejection
