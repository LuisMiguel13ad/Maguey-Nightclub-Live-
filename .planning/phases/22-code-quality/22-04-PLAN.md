---
phase: 22-code-quality
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - maguey-nights/tsconfig.app.json
  - maguey-nights/src/**/*.ts
  - maguey-nights/src/**/*.tsx
autonomous: true

must_haves:
  truths:
    - "tsconfig.app.json has strict: true enabled"
    - "TypeScript build (npx tsc --noEmit) passes with zero errors"
    - "Vite build succeeds with zero errors"
    - "No 'any' types added that weaken type safety (implicit any fixed properly)"
  artifacts:
    - path: "maguey-nights/tsconfig.app.json"
      provides: "Strict TypeScript configuration"
      contains: "\"strict\": true"
  key_links:
    - from: "maguey-nights/tsconfig.app.json"
      to: "maguey-nights/src/"
      via: "TypeScript compilation"
      pattern: "strict.*true"
---

<objective>
Enable TypeScript strict mode on the marketing site (maguey-nights) and fix all resulting type errors across ~59 non-shadcn source files.

Purpose: The marketing site is the simplest of the 3 sites (mostly display components, no payments/scanning). Enabling strict mode catches null-safety bugs, implicit-any issues, and missing type annotations — improving reliability before production launch.

Output: tsconfig.app.json with `strict: true` and all source files passing strict type checking.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@maguey-nights/tsconfig.app.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable strict mode and audit error count</name>
  <files>
    maguey-nights/tsconfig.app.json
  </files>
  <action>
    1. Update `maguey-nights/tsconfig.app.json` to enable strict mode:
       ```json
       "strict": true,
       "noUnusedLocals": false,
       "noUnusedParameters": false,
       "noImplicitAny": true,
       "strictNullChecks": true,
       "noFallthroughCasesInSwitch": true,
       ```
       Keep `noUnusedLocals: false` and `noUnusedParameters: false` to avoid noise from intentionally unused params (consistent with ESLint config).

    2. Run `cd maguey-nights && npx tsc --noEmit 2>&1 | tail -5` to get the error count.

    3. Run `cd maguey-nights && npx tsc --noEmit 2>&1 | grep "error TS" | sort | uniq -c | sort -rn | head -20` to categorize errors by type.

    4. Document the error breakdown. Common categories expected:
       - TS2322 (Type 'X' is not assignable to type 'Y') — null checks needed
       - TS7006 (Parameter 'x' implicitly has an 'any' type) — add type annotations
       - TS2531 (Object is possibly 'null') — add null guards
       - TS2345 (Argument of type 'X' is not assignable to parameter of type 'Y')
       - TS18047 (X is possibly null) — optional chaining needed

    This task only enables the flag and audits. Fixes come in Task 2.
  </action>
  <verify>
    `grep '"strict": true' maguey-nights/tsconfig.app.json` returns a match.
    Error count documented.
  </verify>
  <done>Strict mode enabled in tsconfig.app.json. Error count and categorization documented for systematic fixing.</done>
</task>

<task type="auto">
  <name>Task 2: Fix all strict mode type errors</name>
  <files>
    maguey-nights/src/**/*.ts
    maguey-nights/src/**/*.tsx
  </files>
  <action>
    Fix all TypeScript strict mode errors systematically by category. Apply fixes in this order:

    **Category 1: Implicit any (TS7006, TS7031)**
    - Add explicit type annotations to function parameters, catch clauses, and callback args
    - For event handlers: `(e: React.ChangeEvent<HTMLInputElement>)`, `(e: React.FormEvent)`, etc.
    - For catch blocks: `catch (error: unknown)` then type-narrow with `if (error instanceof Error)`
    - For array methods: `.map((item: ItemType) => ...)`, `.filter((x: Type) => ...)`

    **Category 2: Null checks (TS2531, TS18047, TS18048)**
    - Add optional chaining: `obj?.property` instead of `obj.property`
    - Add nullish coalescing: `value ?? defaultValue`
    - Add type guards where needed: `if (data) { ... }`
    - For Supabase queries: handle `.data` being null/undefined
    - For useRef: `ref.current?.method()` or add null check

    **Category 3: Type assignment (TS2322, TS2345)**
    - Fix type mismatches in props, state, and function return types
    - Add proper generic types to useState: `useState<Type | null>(null)`
    - Fix event handler types to match expected signatures

    **Category 4: Other strict checks**
    - Fix `strictFunctionTypes` issues (if any)
    - Fix `strictPropertyInitialization` (if any class properties)
    - Add return types where inferred type is too wide

    **Rules for fixing:**
    - NEVER add `as any` or `@ts-ignore` to suppress errors
    - NEVER weaken types (e.g., changing `string` to `string | any`)
    - Use `unknown` instead of `any` for truly unknown types, then narrow
    - Preserve existing behavior — only add type safety, don't change logic
    - For shadcn/ui components in `src/components/ui/`: These are auto-generated. If they have errors, add minimal type fixes but don't restructure them.

    After all fixes:
    1. `cd maguey-nights && npx tsc --noEmit` — must exit 0
    2. `cd maguey-nights && npx vite build 2>&1 | tail -10` — build must succeed
  </action>
  <verify>
    `cd maguey-nights && npx tsc --noEmit` exits 0 (zero errors).
    `cd maguey-nights && npx vite build` succeeds.
    `grep -r "as any" maguey-nights/src/ | grep -v node_modules | wc -l` shows no new `as any` additions (or same count as before).
  </verify>
  <done>All strict mode type errors fixed. TypeScript build passes with strict: true. Vite build succeeds. No type safety weakened.</done>
</task>

</tasks>

<verification>
1. `grep '"strict": true' maguey-nights/tsconfig.app.json` — confirmed enabled
2. `cd maguey-nights && npx tsc --noEmit` — zero errors
3. `cd maguey-nights && npx vite build` — build succeeds
4. No `as any` or `@ts-ignore` added to fix errors
5. `noUnusedLocals` and `noUnusedParameters` remain false
</verification>

<success_criteria>
- tsconfig.app.json has strict: true
- TypeScript build passes with zero errors
- Vite build succeeds
- No type safety weakened (no new `as any`)
- All ~59 non-shadcn source files pass strict checking
</success_criteria>

<output>
After completion, create `.planning/phases/22-code-quality/22-04-SUMMARY.md`
</output>
