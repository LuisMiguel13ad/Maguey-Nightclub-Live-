---
phase: 13-code-cleanup-scanner-consolidation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - maguey-pass-lounge/supabase/functions/vip/webhook/index.ts
  - maguey-pass-lounge/VIP_SYSTEM_FILES_ADDED.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "The deprecated vip/webhook directory no longer exists in the codebase"
    - "No active code references to the vip/webhook endpoint remain"
    - "VIP_SYSTEM_FILES_ADDED.md no longer lists the removed webhook"
    - "Other VIP functions (vip/confirmation, vip/create-payment-intent) are untouched"
  artifacts:
    - path: "maguey-pass-lounge/VIP_SYSTEM_FILES_ADDED.md"
      provides: "Updated VIP documentation without deprecated webhook reference"
  key_links:
    - from: "maguey-pass-lounge/supabase/functions/stripe-webhook/index.ts"
      to: "vip/webhook (removed)"
      via: "Stripe webhook is the canonical handler; vip/webhook was deprecated duplicate"
      pattern: "stripe-webhook.*handles.*vip"
---

<objective>
Remove the deprecated VIP webhook endpoint and clean up all references to it in non-planning documentation.

Purpose: The VIP webhook at `supabase/functions/vip/webhook/` was deprecated and consolidated into the main `stripe-webhook` function (documented in the file's own deprecation comment). Keeping dead code increases confusion and maintenance burden. This was flagged as tech debt in the v1.0 milestone audit.

Output: Clean codebase with no deprecated VIP webhook directory, updated documentation.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1.0-MILESTONE-AUDIT.md

# Deprecated file to remove:
@maguey-pass-lounge/supabase/functions/vip/webhook/index.ts (226 lines, marked @deprecated on line 13)

# Documentation with references:
@maguey-pass-lounge/VIP_SYSTEM_FILES_ADDED.md (references vip/webhook on lines 40, 93, 158, 162)

# Canonical handler (NOT modified — just for context):
@maguey-pass-lounge/supabase/functions/stripe-webhook/index.ts (already handles all VIP logic)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete deprecated VIP webhook and update documentation</name>
  <files>
    maguey-pass-lounge/supabase/functions/vip/webhook/index.ts
    maguey-pass-lounge/VIP_SYSTEM_FILES_ADDED.md
  </files>
  <action>
**Step 1 — Delete the deprecated VIP webhook directory:**
```bash
rm -rf maguey-pass-lounge/supabase/functions/vip/webhook/
```

This removes only the `webhook/` subdirectory. The other VIP functions remain:
- `vip/confirmation/index.ts` — active, NOT deprecated
- `vip/create-payment-intent/index.ts` — active, NOT deprecated

**Step 2 — Update VIP_SYSTEM_FILES_ADDED.md:**

This file documents what VIP system files exist. Remove all references to the deleted webhook:

1. Remove the line referencing `supabase/functions/vip/webhook/index.ts` from the file listing (around line 40)
2. Remove the route mapping row `| app/api/webhooks/vip/route.ts | supabase/functions/vip/webhook/index.ts |` (around line 93)
3. Remove the deployment instruction `supabase functions deploy vip/webhook` (around line 158)
4. Remove the Stripe webhook endpoint reference `https://your-project.supabase.co/functions/v1/vip/webhook` (around line 162)
5. Where these references are removed, add a brief note: "VIP webhook consolidated into main stripe-webhook function" if there is a relevant section for it, or simply remove the lines if they are in a list.

**Step 3 — Verify no active code imports or calls the VIP webhook:**

Search the source code (excluding .planning/ directory and .md files) for any remaining `vip/webhook` references:
```bash
grep -rn "vip/webhook" maguey-pass-lounge/src/ maguey-pass-lounge/supabase/ --include="*.ts" --include="*.tsx" --include="*.js"
```

This should return zero matches after deletion. If any code references remain (e.g., a URL string pointing to the endpoint), update them to use `stripe-webhook` instead.

**IMPORTANT:** Do NOT modify any files in `.planning/` — those are historical records and should remain as-is. Only modify active code and documentation files.
  </action>
  <verify>
Verify the webhook directory is gone:
```bash
ls maguey-pass-lounge/supabase/functions/vip/webhook/ 2>&1
```
(Should show "No such file or directory")

Verify other VIP functions still exist:
```bash
ls maguey-pass-lounge/supabase/functions/vip/confirmation/index.ts maguey-pass-lounge/supabase/functions/vip/create-payment-intent/index.ts
```
(Should list both files)

Verify no active code references remain:
```bash
grep -rn "vip/webhook" maguey-pass-lounge/src/ maguey-gate-scanner/src/ maguey-nights/src/ --include="*.ts" --include="*.tsx" 2>/dev/null
```
(Should return no matches)
  </verify>
  <done>Deprecated vip/webhook directory deleted, VIP_SYSTEM_FILES_ADDED.md updated, no active code references to vip/webhook remain, other VIP functions (confirmation, create-payment-intent) untouched</done>
</task>

</tasks>

<verification>
1. `maguey-pass-lounge/supabase/functions/vip/webhook/` directory does not exist
2. `maguey-pass-lounge/supabase/functions/vip/confirmation/index.ts` still exists (untouched)
3. `maguey-pass-lounge/supabase/functions/vip/create-payment-intent/index.ts` still exists (untouched)
4. No `.ts` or `.tsx` files in `src/` directories reference `vip/webhook`
5. `VIP_SYSTEM_FILES_ADDED.md` no longer lists the deprecated webhook
</verification>

<success_criteria>
- Deprecated VIP webhook endpoint removed from codebase entirely
- No orphaned references to vip/webhook in active source code
- Other VIP edge functions remain functional and unchanged
- Documentation updated to reflect removal
</success_criteria>

<output>
After completion, create `.planning/phases/13-code-cleanup-scanner-consolidation/13-02-SUMMARY.md`
</output>
