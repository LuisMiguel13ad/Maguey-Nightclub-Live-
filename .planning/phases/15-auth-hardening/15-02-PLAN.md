---
phase: 15-auth-hardening
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - maguey-gate-scanner/src/pages/auth/EmployeeLogin.tsx
  - maguey-gate-scanner/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Employee can log in at /auth/employee with email/password (Luismbadillo13@gmail.com)"
    - "After employee login, user is redirected to /scanner"
    - "Remember me checkbox stores email in localStorage (key: maguey_employee_email)"
    - "No signup form, no password reset form on employee login page"
    - "If owner logs in at /auth/employee, they are redirected to /dashboard (convenience, not error)"
    - "Already-authenticated employee visiting /auth/employee is redirected to /scanner"
    - "Link to /auth/owner exists for owner access"
  artifacts:
    - path: "maguey-gate-scanner/src/pages/auth/EmployeeLogin.tsx"
      provides: "Streamlined employee login page optimized for mobile use at the door"
      contains: "signInWithPassword"
  key_links:
    - from: "maguey-gate-scanner/src/pages/auth/EmployeeLogin.tsx"
      to: "supabase.auth.signInWithPassword()"
      via: "Email/password login for employee account"
      pattern: "signInWithPassword"
    - from: "maguey-gate-scanner/src/pages/auth/EmployeeLogin.tsx"
      to: "/scanner"
      via: "Post-login redirect for employee role"
      pattern: "navigate.*scanner"
---

<objective>
Create a streamlined employee login page at `/auth/employee` optimized for scanner staff at the nightclub door. This page has minimal UI, large touch-friendly inputs, and a "remember me" feature for the email address.

Purpose: Separate the employee login from the owner login. Employees need a fast, no-frills login that works well on mobile devices at the door. No signup, no password reset, no invitation handling. This is part of P0 requirement R07.

Output: One new file (`EmployeeLogin.tsx`) plus route addition in App.tsx.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/phases/15-auth-hardening/15-CONTEXT.md
@.planning/phases/15-auth-hardening/15-RESEARCH.md

Key source files to reference:
@maguey-gate-scanner/src/pages/Auth.tsx — Current login logic to port (lines 219-250 for login handler)
@maguey-gate-scanner/src/App.tsx — Route configuration (add /auth/employee)
@maguey-gate-scanner/src/lib/auth-utils.ts — AUTH_ROUTES, navigateByRole (created by Plan 15-01)
@maguey-gate-scanner/src/lib/auth.ts — getUserRole
@maguey-gate-scanner/src/contexts/AuthContext.tsx — useAuth, useRole hooks

LOCKED DECISIONS from 15-CONTEXT.md:
- Employee: /auth/employee with simplified auth
- /auth redirects to /auth/employee by default
- Role-based redirect after login (employee → /scanner)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EmployeeLogin.tsx</name>
  <files>maguey-gate-scanner/src/pages/auth/EmployeeLogin.tsx</files>
  <action>
Create `maguey-gate-scanner/src/pages/auth/EmployeeLogin.tsx`. This is a minimal, mobile-optimized login page.

**Imports:**
- React hooks: `useState`, `useEffect`
- React Router: `useNavigate`
- Supabase: `supabase` from `@/lib/supabase`, `isSupabaseConfigured` from `@/lib/supabase-config`
- Auth: `getUserRole` from `@/lib/auth`, `useAuth`, `useRole` from `@/contexts/AuthContext`
- Audit: `logAuditEvent` from `@/lib/audit-service`
- Auth utils: `AUTH_ROUTES` from `@/lib/auth-utils`
- UI: `Button`, `Input`, `Label`, `Card/CardContent/CardHeader/CardTitle` from shadcn
- Icons: `Shield` from lucide-react
- Toast: `useToast` from `@/hooks/use-toast`

**Already-authenticated redirect (useEffect):**
- If `useAuth()` returns a user:
  - If role is `owner` or `promoter`: redirect to `/dashboard`
  - If role is `employee`: redirect to `/scanner`
- This handles the case where an already-logged-in user navigates to the login page

**Remember me (useEffect on mount):**
- On mount, check `localStorage.getItem('maguey_employee_email')`
- If exists, pre-fill the email field and set `rememberMe` to true

**Login handler:**
```typescript
const handleLogin = async (e: React.FormEvent) => {
  e.preventDefault();
  setLoading(true);
  try {
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) throw error;

    // Store/clear email for remember me
    if (rememberMe) {
      localStorage.setItem('maguey_employee_email', email);
    } else {
      localStorage.removeItem('maguey_employee_email');
    }

    // Audit log
    logAuditEvent('login', 'user', 'Employee logged in', {
      userId: data.user?.id,
      severity: 'info',
      metadata: { email: data.user?.email },
    }).catch(() => {});

    // Check role - if owner, redirect to dashboard (convenience)
    const userRole = getUserRole(data.user);
    if (userRole === 'owner' || userRole === 'promoter') {
      toast({ title: "Welcome!", description: "Redirecting to dashboard." });
      navigate("/dashboard");
    } else {
      toast({ title: "Welcome!", description: "Ready to scan." });
      navigate("/scanner");
    }
  } catch (error: any) {
    toast({
      variant: "destructive",
      title: "Login Failed",
      description: error.message === 'Invalid login credentials'
        ? "Incorrect email or password."
        : error.message,
    });
  } finally {
    setLoading(false);
  }
};
```

**UI Layout — Minimal and Touch-Friendly:**
```
Card with dark theme matching current Auth.tsx styling:

  [Maguey Logo - /logo.png, smaller than Auth.tsx: h-16]

  "Staff Scanner" (title, with Shield icon)

  [Email input - larger: h-12, pre-filled if remember me]
  [Password input - larger: h-12]

  [x] Remember me    (checkbox + label, stores email only)

  [SIGN IN button - full width, h-12, green gradient]

  "Need help? Contact your manager"  (small muted text, no link)

  "Owner login →"  (small link to /auth/owner)
```

**State variables:**
- `email`, `password` (strings)
- `loading` (boolean)
- `rememberMe` (boolean, default from localStorage check)

**Styling:**
- Same dark background and Card styling as current Auth.tsx (`bg-background`, `shadow-glow-lime`)
- Inputs with `h-12` for touch-friendly size (larger than default)
- Sign In button with `h-12` and `bg-gradient-green`
- Minimal text — no descriptions, no helper text beyond "Need help?"

Do NOT include: signup form, password reset, invitation handling, demo buttons, promote-to-owner, or any dev tools.
  </action>
  <verify>Run `cd /Users/luismiguel/Desktop/Maguey-Nightclub-Live/maguey-gate-scanner && npx tsc --noEmit` to verify no type errors.</verify>
  <done>EmployeeLogin.tsx created with streamlined login, remember me, role-based redirect, and mobile-optimized UI.</done>
</task>

<task type="auto">
  <name>Task 2: Add /auth/employee route to App.tsx</name>
  <files>maguey-gate-scanner/src/App.tsx</files>
  <action>
1. Add import: `import EmployeeLogin from "./pages/auth/EmployeeLogin";`
2. Add route after the `/auth/owner` route (added by Plan 15-01):
   `<Route path="/auth/employee" element={<EmployeeLogin />} />`

NOTE: If Plan 15-01 has already added its route and import, add this one adjacent. If Plan 15-01 hasn't run yet, add both the import and route. The route should appear between `/auth` and `/scanner` routes.
  </action>
  <verify>Run `cd /Users/luismiguel/Desktop/Maguey-Nightclub-Live/maguey-gate-scanner && npx tsc --noEmit`. Verify the route exists by checking App.tsx.</verify>
  <done>/auth/employee route added to App.tsx.</done>
</task>

</tasks>

<verification>
1. `cd maguey-gate-scanner && npx tsc --noEmit` — no TypeScript errors
2. `npm run dev --workspace=maguey-gate-scanner` — site starts without errors
3. Navigate to `/auth/employee` — renders streamlined login with Shield icon and "Staff Scanner" title
4. Login with `Luismbadillo13@gmail.com` / `MagueyScanner123` → redirects to `/scanner`
5. Check "Remember me" → login → navigate back to `/auth/employee` → email is pre-filled
6. Uncheck "Remember me" → login → navigate back → email is empty
7. "Owner login" link navigates to `/auth/owner`
8. Login with owner credentials at `/auth/employee` → redirects to `/dashboard` (convenience)
</verification>

<success_criteria>
- Employee can log in at /auth/employee with real Supabase credentials
- Remember me stores and pre-fills email address
- No signup, password reset, or invitation UI exists on employee login page
- Owner users are redirected to /dashboard (not blocked)
- Already-authenticated users are redirected immediately
- Touch-friendly UI with h-12 inputs and buttons
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-auth-hardening/15-02-SUMMARY.md`
</output>
